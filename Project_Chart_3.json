{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Genre Distribution of Movies with Percentages",
  "data": {
    "url": "https://raw.githubusercontent.com/aydan-ui/aydan-ui.github.io/refs/heads/main/popular_movies-4.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {
      "calculate": "split(datum.genre_ids, ',')",
      "as": "genre_list"
    },
    {
      "flatten": ["genre_list"]
    },
    {
      "calculate": "parseInt(datum.genre_list)",
      "as": "genre_id"
    },
    {
      "lookup": "genre_id",
      "from": {
        "data": {
          "values": [
            {"id": 28, "genre": "Action"},
            {"id": 12, "genre": "Adventure"},
            {"id": 16, "genre": "Animation"},
            {"id": 35, "genre": "Comedy"},
            {"id": 80, "genre": "Crime"},
            {"id": 99, "genre": "Documentary"},
            {"id": 18, "genre": "Drama"},
            {"id": 10751, "genre": "Family"},
            {"id": 14, "genre": "Fantasy"},
            {"id": 36, "genre": "History"},
            {"id": 27, "genre": "Horror"},
            {"id": 10402, "genre": "Music"},
            {"id": 9648, "genre": "Mystery"},
            {"id": 10749, "genre": "Romance"},
            {"id": 878, "genre": "Science Fiction"},
            {"id": 10770, "genre": "TV Movie"},
            {"id": 53, "genre": "Thriller"},
            {"id": 10752, "genre": "War"},
            {"id": 37, "genre": "Western"}
          ]
        },
        "key": "id",
        "fields": ["genre"]
      }
    },
    {
      "filter": "datum.genre != null"
    },
    {
      "aggregate": [{"op": "count", "field": "genre_id", "as": "genre_count"}],
      "groupby": ["genre"]
    },
    {
      "joinaggregate": [{"op": "sum", "field": "genre_count", "as": "total_count"}]
    },
    {
      "calculate": "datum.genre_count / datum.total_count * 100",
      "as": "percentage"
    }
  ],
  "layer": [
    {
      "mark": {"type": "arc", "innerRadius": 50},
      "encoding": {
        "theta": {"field": "genre_count", "type": "quantitative"},
        "color": {"field": "genre", "type": "nominal"},
        "tooltip": [
          {"field": "genre", "type": "nominal", "title": "Genre"},
          {"field": "genre_count", "type": "quantitative", "title": "Count"},
          {"field": "percentage", "type": "quantitative", "title": "Percentage", "format": ".1f"}
        ]
      }
    },
    {
      "mark": {"type": "text", "radiusOffset": 10},
      "encoding": {
        "theta": {"field": "genre_count", "type": "quantitative"},
        "text": {
          "field": "percentage",
          "type": "quantitative",
          "format": ".1f"
        },
        "color": {"value": "white"}
      }
    }
  ],
  "title": {
    "text": "Genre Distribution of Movies with Percentages",
    "anchor": "start",
    "offset": 20
  }
}
